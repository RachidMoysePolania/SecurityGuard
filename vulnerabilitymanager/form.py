from django import forms
from django import forms
from django.forms import widgets
from .models import Task, Tickets
from django.contrib.auth.models import User
import datetime

class AddTask(forms.ModelForm):
    class Meta:
        model = Task
        fields = ['TaskName', 'TaskDescription', 'UserTask', 'TicketAssigned', 'TaskDueDate', 'TaskState', 'TaskFiles']
          
        TaskName = forms.CharField(max_length=30)
        TaskDescription = forms.CharField(max_length=200)
        TaskDueDate = forms.DateField(widget=forms.DateInput, required=True)
        TaskFiles = forms.FileField()
        
        UserTask = forms.ModelMultipleChoiceField(queryset=User.objects.all(), widget=forms.CheckboxSelectMultiple)
        TicketAssigned = forms.ModelMultipleChoiceField(queryset=Tickets.objects.all(), widget=forms.CheckboxSelectMultiple)

        def clean_date(self):
            TaskDueDate = self.clean_date['TaskDueDate']
            if TaskDueDate < datetime.date.today():
                raise forms.ValidationError("La fecha no puede ser menor a hoy!")
            return TaskDueDate